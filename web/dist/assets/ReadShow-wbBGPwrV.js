import{E as a}from"./el-button-wvYaTM86.js";/* empty css                 */import{E as e}from"./el-scrollbar-vybkKUqc.js";import{g as l,a as s,d as t,b as u,c as o,e as n,E as d,f as c}from"./el-collapse-item-xFHKyjm6.js";import{E as r,a as i}from"./el-switch-toBBjcd3.js";import{a as v}from"./el-page-header-hhNj0jpu.js";import{g as m}from"./texthandle-7F_vs62c.js";import{g as p,a as f}from"./ai-nw8x7oml.js";import{g,d as w,e as I}from"./test-y3wzIP-I.js";import{u as y}from"./userStore-7h9e-sH4.js";import{_ as h,Z as k,g as C,h as _,j,o as q,k as b,t as x,l as V,w as A,a as S,I as z,F as D,O as E,u as T,v as F,m as N,n as R,x as U,y as M}from"./index-afE12XCz.js";import{E as O}from"./index-N5fRpmYF.js";import{E as K}from"./index-JPUmXDR2.js";import"./castArray-k9TcYJOl.js";import"./index-ldI0-Ir2.js";import"./request2-8GU6WOJp.js";import"./axios--miOKxDG.js";import"./validator-X17wg_rN.js";import"./directive-J_YZ0NkB.js";import"./request-MLV9EytQ.js";const L=a=>(U("data-v-0ec6cba1"),a=a(),M(),a),H={class:"box"},J={class:"header"},P={class:"left"},Y=L((()=>x("span",null,"阅卷",-1))),Z={class:"right"},$={class:"main"},B={class:"left"},G=L((()=>x("div",{class:"tip"},"是否显示学生姓名",-1))),Q={class:"switch"},W={class:"title"},X=["onClick"],aa={class:"center"},ea={class:"top"},la={key:1,class:"btn"},sa={key:2,class:"content"},ta={class:"ret"},ua=["src"],oa={class:"bottom"},na={class:"score"},da={class:"score-top"},ca={class:"num"},ra=L((()=>x("span",null,"AI打分:",-1))),ia=L((()=>x("span",null,"老师打分:",-1))),va={class:"btn"},ma={class:"score-bottom"},pa={class:"num"},fa={class:"keypad"},ga={class:"btn"},wa={class:"comment"},Ia={class:"comment1"},ya=L((()=>x("div",{class:"title"},"AI评价:",-1))),ha={class:"comment2"},ka=L((()=>x("div",{class:"title"},"老师评价:",-1))),Ca={class:"button"},_a=h({__name:"ReadShow",setup(h){const U=y(),M=k(),L=C(),_a=M.query.examId,ja=M.query.paperId,qa=M.query.quesList,ba=_(""),xa=_(""),Va=_(""),Aa=_(!0),Sa=_([]),za=_("");(async a=>{const e=await l(String(a));Sa.value=e.data.data;const s=await g(a);za.value=s.data.data.examName})(_a);const Da=_({quesId:"",quesKindId:"",quesContent:"",quesAnswer:"",quesDefaultScore:"",ansImg:"",answer:""}),Ea=_({}),Ta=_(),Fa=_([""]),Na=_(""),Ra=_(""),Ua=_(""),Ma=_(""),Oa=_(""),Ka=_(-1),La=_(-1),Ha=_(-1),Ja=async(a,e,l,s)=>{Ka.value=l,La.value=s,Va.value=e.certId,Oa.value=s;const t=r.service({fullscreen:!0}),o=await u(e.certId,a);xa.value=o.data.data.answerId,ba.value=o.data.data.quesId;const n=await I(a);Da.value=n.data.data,Da.value.ansImg=o.data.data.ansImg,Ea.value=Ea.value=e,Ta.value=l+1,Pa(),t.close()},Pa=async()=>{const a=new FormData;a.append("img",Da.value.ansImg),a.append("typ","INFO");const e=await m(a);Da.value.answer=e.data.res;const l=await o(xa.value);l.data.data.length>0?(Ma.value=l.data.data[0].id,Fa.value[0]=l.data.data[0].AIComment,Ra.value=l.data.data[0].AIScore,Ua.value=l.data.data[0].TeacherScore,Na.value=l.data.data[0].TeacherComment):(Fa.value=[""],Ra.value="",Ua.value="",Na.value="")},Ya=async()=>{const a=new FormData;a.append("question",Da.value.quesContent),a.append("full",Da.value.quesDefaultScore),a.append("answer",Da.value.answer),a.append("correct",Da.value.quesAnswer);const e=r.service({fullscreen:!0}),l=await p(a);Ra.value=l.data.score,Fa.value[0]=l.data.reson,e.close()},Za=async()=>{const a=new FormData;a.append("question",Da.value.quesContent),a.append("answer",Da.value.answer),a.append("correct",Da.value.quesAnswer),a.append("count",1);const e=r.service({fullscreen:!0}),l=await f(a);Fa.value[0]=l.data[0],e.close()},$a=[1,2,3,4,5,6,7,8,9],Ba=()=>{Ua.value=""},Ga=async()=>{const a=new Date,e=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" "+("0"+a.getHours()).slice(-2)+":"+("0"+a.getMinutes()).slice(-2),l={examId:_a,paperId:ja,quesId:ba.value,answerId:xa.value,marKTime:e,teaId:U.userInfo.roleId,AIScore:Ra.value||0,TeacherScore:Ua.value||0,AIComment:Fa.value[0]||"",TeacherComment:Na.value||""},t=await s(l);200===t.data.code&&(Ma.value=t.data.data.id),O.success("批改完成")},Qa=()=>{Oa.value===Sa.value.length-1?Ja(qa[Ta.value],Sa.value[0],Ta.value,0):Ja(qa[Ta.value-1],Sa.value[Oa.value+1],Ta.value-1,Oa.value+1)},Wa=async()=>{await t(Ma.value),O.success("删除成功"),Fa.value=[""],Ra.value="",Ua.value="",Na.value=""},Xa=async()=>{const a=r.service({fullscreen:!0});for(let e of Sa.value){let a=0,l=[];for(let t of qa){const s=(await u(e.certId,t)).data.data.answerId,n=await o(s),d=n.data.data[0].TeacherScore?n.data.data[0].TeacherScore:0;a+=d||0,l.push(d)}const s={examId:_a,paperId:ja,certId:e.certId,detailScores:"["+l.join(",")+"]",finalScore:a};await n(s)}a.close(),O.success("提交成功"),await w(_a,3),L.push("/read")};return(l,s)=>{const t=v,u=a,o=i,n=d,r=c,m=e,p=K,f=j("a-button");return q(),b("div",H,[x("div",J,[x("div",P,[V(t,{onClick:s[0]||(s[0]=a=>l.$router.go(-1)),icon:l.ArrowLeft},{content:A((()=>[Y,x("span",null,F(za.value),1)])),_:1},8,["icon"])]),x("div",Z,[V(u,{onClick:Xa,size:"large",color:"#045afe"},{default:A((()=>[N("提交阅卷结果")])),_:1})])]),x("div",$,[x("div",B,[V(m,null,{default:A((()=>[V(r,{modelValue:Ha.value,"onUpdate:modelValue":s[2]||(s[2]=a=>Ha.value=a),onChange:l.handleChange},{default:A((()=>[G,x("div",Q,[V(o,{modelValue:Aa.value,"onUpdate:modelValue":s[1]||(s[1]=a=>Aa.value=a),size:"large","active-text":"Open","inactive-text":"Close"},null,8,["modelValue"])]),(q(!0),b(D,null,E(T(qa),((a,e)=>(q(),S(n,{name:e,key:e},{title:A((()=>[x("span",W," 第"+F(e+1)+"题 ",1)])),default:A((()=>[x("ul",null,[(q(!0),b(D,null,E(Sa.value,((l,s)=>(q(),b("li",{onClick:t=>Ja(a,l,e,s),key:l.id},[Aa.value?z("",!0):(q(),b("a",{key:0,class:R({active:Ka.value==e&&La.value==s}),href:"javascript:;"},F(s+1)+"号学生",3)),Aa.value?(q(),b("a",{key:1,class:R({active:Ka.value==e&&La.value==s}),href:"javascript:;"},F(l.stuName),3)):z("",!0)],8,X)))),128))])])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})]),x("div",aa,[x("div",ea,[Ta.value?z("",!0):(q(),S(u,{key:0,type:"primary",plain:"",size:"large"},{default:A((()=>[N(" 请从左侧选择待批改试题以及学生")])),_:1})),Ta.value?(q(),b("div",la,[V(u,{type:"primary",plain:"",size:"large"},{default:A((()=>[N("第"+F(Ta.value)+"题",1)])),_:1}),V(u,{type:"danger",plain:"",size:"large"},{default:A((()=>[N("单选题")])),_:1}),Aa.value?(q(),S(u,{key:0,type:"success",plain:"",size:"large"},{default:A((()=>[N(F(Ea.value.stuName),1)])),_:1})):z("",!0),Aa.value?z("",!0):(q(),S(u,{key:1,type:"success",plain:"",size:"large"},{default:A((()=>[N(F(Ea.value.stuId),1)])),_:1}))])):z("",!0),Ta.value?(q(),b("div",sa,[V(u,{size:"large",color:"rgb(29, 75, 131)",plain:""},{default:A((()=>[N(" 参考答案:"+F(Da.value.quesAnswer),1)])),_:1})])):z("",!0)]),x("div",ta,[x("img",{src:Da.value.ansImg,alt:""},null,8,ua)]),x("div",oa,[x("div",na,[x("div",da,[x("div",ca,[ra,V(p,{modelValue:Ra.value,"onUpdate:modelValue":s[3]||(s[3]=a=>Ra.value=a)},null,8,["modelValue"]),ia,V(p,{modelValue:Ua.value,"onUpdate:modelValue":s[4]||(s[4]=a=>Ua.value=a),modelModifiers:{number:!0},placeholder:"请输入分数"},null,8,["modelValue"])]),x("div",va,[V(u,{onClick:Ya,class:"wenti",color:"#045afe"},{default:A((()=>[N("AI评阅")])),_:1})])]),x("div",ma,[x("div",pa,[x("div",fa,[(q(),b(D,null,E($a,(a=>V(u,{key:a,onClick:e=>(a=>{Ua.value+=a})(a)},{default:A((()=>[N(F(a),1)])),_:2},1032,["onClick"]))),64))])]),x("div",ga,[V(f,{class:"a",onClick:Ba},{default:A((()=>[N("清空")])),_:1}),V(f,{class:"a",onClick:s[5]||(s[5]=a=>Ua.value=0)},{default:A((()=>[N("0分")])),_:1}),V(f,{class:"a",onClick:s[6]||(s[6]=a=>Ua.value=Da.value.quesDefaultScore)},{default:A((()=>[N("满分")])),_:1})])])]),x("div",wa,[x("div",Ia,[ya,V(p,{value:Fa.value[0],autosize:{minRows:6,maxRows:10},type:"textarea"},null,8,["value"])]),x("div",ha,[ka,V(p,{modelValue:Na.value,"onUpdate:modelValue":s[7]||(s[7]=a=>Na.value=a),autosize:{minRows:6,maxRows:10},type:"textarea",placeholder:"手动输入评价"},null,8,["modelValue"])])]),x("div",Ca,[V(f,{onClick:Za},{default:A((()=>[N("重置评价")])),_:1}),V(u,{onClick:Ga,size:"large"},{default:A((()=>[N("批改完成")])),_:1}),V(u,{disabled:""==Ma.value,onClick:Wa,size:"large",plain:"",type:"danger"},{default:A((()=>[N("删除打分结果")])),_:1},8,["disabled"]),V(u,{disabled:Ta.value==T(qa).length&&Oa.value==Sa.value.length-1,size:"large",type:"info",onClick:Qa,color:"#045afe"},{default:A((()=>[N("下一份")])),_:1},8,["disabled"])])])])])])}}},[["__scopeId","data-v-0ec6cba1"]]);export{_a as default};

import"./base-fLZH5HYv.js";import{E as _e,a as fe}from"./el-tab-pane-ADmHeYbl.js";import{a as Ie,E as ge}from"./el-form-item-Se7SvOzn.js";/* empty css                 */import{E as ye}from"./el-scrollbar-IRktW7Zh.js";import{g as we,a as he,d as Ce,b as Q,c as ee,e as Ae,E as ke,f as Se}from"./el-collapse-item-p7LRgNvL.js";import{E as F,a as Ee}from"./el-switch-gxFK0I1j.js";import{E as qe}from"./el-button-ERDUNANg.js";import"./el-divider-EY_T2mV_.js";import{E as be}from"./el-page-header-u3Ey0h0a.js";import{g as xe}from"./texthandle-YbIOrDGw.js";import{g as De,a as Ve}from"./ai-CC3AAqXz.js";import{g as ze,d as Be,e as Re}from"./test-_J6LAQoB.js";import{u as Te}from"./userStore-ZLRZICUc.js";import{_ as Ne,Z as Pe,g as Fe,h as n,j as v,s as r,k as o,w as t,a as V,I as g,u as ae,o as d,t as f,l as i,F as H,O as K,n as te,x as Me,y as Le}from"./index-8Q_9VYoB.js";import{E as Y}from"./index-KvpZgIRM.js";import{E as Ue}from"./index-EGs59zJd.js";import"./strings-KykFHDex.js";import"./vnode-V_EyjqrJ.js";import"./castArray-RdmDEgzm.js";import"./_baseClone-kDeojI09.js";import"./_Uint8Array-LNA8QHR0.js";import"./_initCloneObject-1JMVk_fm.js";import"./index-NzKbfIph.js";import"./request2-j_m9nIWH.js";import"./axios-_sX4vCAy.js";import"./validator-SivaTYXf.js";import"./request-_oO3txSX.js";const se=z=>(Me("data-v-672bea97"),z=z(),Le(),z),$e={class:"box"},je={class:"header"},Oe={class:"left"},He=se(()=>r("span",null,"阅卷",-1)),Ke={class:"right"},Ye={class:"main"},Ze={class:"left"},Ge=se(()=>r("div",{class:"tip"},"是否显示学生姓名",-1)),Je={class:"switch"},We={class:"title"},Xe=["onClick"],Qe={class:"center"},ea={class:"top"},aa={key:1,class:"btn"},ta={key:2,class:"content"},sa={class:"ret"},oa=["src"],la={class:"bottom"},na={key:0},ra={class:"comment"},ua={class:"end"},ca={__name:"ReadShow",setup(z){const Z=Te(),M=Pe(),oe=Fe();console.log(Z.userInfo);const B=M.query.examId,G=M.query.paperId,E=M.query.quesList,J=n(""),L=n(""),le=n(""),C=n(!0),y=n([]),W=n("");(async e=>{const a=await we(String(e));y.value=a.data.data;const s=await ze(e);W.value=s.data.data.examName})(B);const u=n({quesId:"",quesKindId:"",quesContent:"",quesAnswer:"",quesDefaultScore:"",ansImg:"",answer:""}),R=n({}),m=n(),q=n([""]),b=n(""),A=n(""),w=n(""),T=n(""),x=n(""),U=n(-1),$=n(-1),X=n(-1),j=async(e,a,s,l)=>{U.value=s,$.value=l,le.value=a.certId,x.value=l;const I=F.service({fullscreen:!0}),_=await Q(a.certId,e);L.value=_.data.data.answerId,J.value=_.data.data.quesId;const h=await Re(e);u.value=h.data.data,u.value.ansImg=_.data.data.ansImg,console.log(u.value),R.value=R.value=a,m.value=s+1,ne(),I.close()},ne=async()=>{const e=new FormData;e.append("img",u.value.ansImg),e.append("typ","INFO");const a=await xe(e);u.value.answer=a.data.res;const s=await ee(L.value);s.data.data.length>0?(T.value=s.data.data[0].id,q.value[0]=s.data.data[0].AIComment,A.value=s.data.data[0].AIScore,w.value=s.data.data[0].TeacherScore,b.value=s.data.data[0].TeacherComment):(q.value=[""],A.value="",w.value="",b.value="")},re=async()=>{const e=new FormData;e.append("question",u.value.quesContent),e.append("full",u.value.quesDefaultScore),e.append("answer",u.value.answer),e.append("correct",u.value.quesAnswer);const a=F.service({fullscreen:!0}),s=await De(e);A.value=s.data.score,a.close()},ue=async()=>{const e=new FormData;e.append("question",u.value.quesContent),e.append("answer",u.value.answer),e.append("correct",u.value.quesAnswer),e.append("count",1);const a=F.service({fullscreen:!0}),s=await Ve(e);console.log(s.data),q.value=s.data,a.close()},ce=async()=>{const e=new Date,a=e.getFullYear(),s=e.getMonth()+1,l=e.getDate(),I=("0"+e.getHours()).slice(-2),_=("0"+e.getMinutes()).slice(-2),h=a+"/"+s+"/"+l+" "+I+":"+_,D={examId:B,paperId:G,quesId:J.value,answerId:L.value,marKTime:h,teaId:Z.userInfo.roleId,AIScore:A.value,TeacherScore:w.value,AIComment:q.value[0],TeacherComment:b.value};console.log(D);const p=await he(D);console.log(p.data),p.data.code===200&&(T.value=p.data.data.id),Y.success("批改完成")},de=()=>{x.value===y.value.length-1?j(E[m.value],y.value[0],m.value,0):j(E[m.value-1],y.value[x.value+1],m.value-1,x.value+1)},ie=async()=>{const e=await Ce(T.value);console.log(e.data),Y.success("删除成功")},me=async()=>{const e=F.service({fullscreen:!0});for(let a of y.value){let s=0,l=[];for(let h of E){const p=(await Q(a.certId,h)).data.data.answerId;console.log(p);const k=await ee(p),N=k.data.data[0].TeacherScore?k.data.data[0].TeacherScore:0;s+=N,l.push(N)}const I={examId:B,paperId:G,certId:a.certId,detailScores:"["+l.join(",")+"]",finalScore:s};console.log(I);const _=await Ae(I);console.log(_.data)}e.close(),Y.success("提交成功"),await Be(B,3),oe.push("/read")};return(e,a)=>{const s=be,l=qe,I=Ee,_=ke,h=Se,D=ye,p=ge,k=Ue,N=Ie,pe=fe,ve=_e;return d(),v("div",$e,[r("div",je,[r("div",Oe,[o(s,{onClick:a[0]||(a[0]=c=>e.$router.go(-1)),icon:e.ArrowLeft},{content:t(()=>[He,r("span",null,f(W.value),1)]),_:1},8,["icon"])]),r("div",Ke,[o(l,{onClick:me},{default:t(()=>[i("提交阅卷结果")]),_:1})])]),r("div",Ye,[r("div",Ze,[o(D,null,{default:t(()=>[o(h,{modelValue:X.value,"onUpdate:modelValue":a[2]||(a[2]=c=>X.value=c),onChange:e.handleChange},{default:t(()=>[Ge,r("div",Je,[o(I,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=c=>C.value=c),size:"large","active-text":"Open","inactive-text":"Close"},null,8,["modelValue"])]),(d(!0),v(H,null,K(ae(E),(c,S)=>(d(),V(_,{name:S,key:S},{title:t(()=>[r("span",We," 第"+f(S+1)+"题 ",1)]),default:t(()=>[r("ul",null,[(d(!0),v(H,null,K(y.value,(P,O)=>(d(),v("li",{onClick:ia=>j(c,P,S,O),key:P.id},[C.value?g("",!0):(d(),v("a",{key:0,class:te({active:U.value==S&&$.value==O}),href:"javascript:;"},f(P.stuId),3)),C.value?(d(),v("a",{key:1,class:te({active:U.value==S&&$.value==O}),href:"javascript:;"},f(P.stuName),3)):g("",!0)],8,Xe))),128))])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),r("div",Qe,[r("div",ea,[m.value?g("",!0):(d(),V(l,{key:0,type:"primary",plain:"",size:"large"},{default:t(()=>[i(" 请从左侧选择待批改试题以及学生")]),_:1})),m.value?(d(),v("div",aa,[o(l,{type:"primary",plain:"",size:"large"},{default:t(()=>[i("第"+f(m.value)+"题",1)]),_:1}),o(l,{type:"danger",plain:"",size:"large"},{default:t(()=>[i("单选题")]),_:1}),C.value?(d(),V(l,{key:0,type:"success",plain:"",size:"large"},{default:t(()=>[i(f(R.value.stuName),1)]),_:1})):g("",!0),C.value?g("",!0):(d(),V(l,{key:1,type:"success",plain:"",size:"large"},{default:t(()=>[i(f(R.value.stuId),1)]),_:1}))])):g("",!0),m.value?(d(),v("div",ta,[o(l,{size:"large",color:"rgb(29, 75, 131)",plain:""},{default:t(()=>[i(" 参考答案:"+f(u.value.quesAnswer),1)]),_:1})])):g("",!0)]),r("div",sa,[r("img",{src:u.value.ansImg,alt:""},null,8,oa)]),r("div",la,[o(N,null,{default:t(()=>[o(p,null,{default:t(()=>[A.value!=""?(d(),v("div",na," AI建议: "+f(A.value)+"分 ",1)):g("",!0),o(l,{onClick:re,class:"wenti",type:"success"},{default:t(()=>[i("获取AI打分")]),_:1})]),_:1}),o(p,{lable:"老师打分:"},{default:t(()=>[o(k,{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=c=>w.value=c),modelModifiers:{number:!0},placeholder:"请输入分数"},null,8,["modelValue"])]),_:1}),o(p,null,{default:t(()=>[o(l,{type:"primary",onClick:a[4]||(a[4]=c=>w.value=0)},{default:t(()=>[i("0分")]),_:1}),o(l,{type:"danger",onClick:a[5]||(a[5]=c=>w.value=u.value.quesDefaultScore)},{default:t(()=>[i("满分")]),_:1})]),_:1})]),_:1}),o(ve,{"tab-position":"left"},{default:t(()=>[(d(!0),v(H,null,K(q.value,c=>(d(),V(pe,{label:"AI评价",key:c},{default:t(()=>[o(k,{value:c,autosize:{minRows:6,maxRows:10},type:"textarea"},null,8,["value"]),o(l,{onClick:ue,type:"success"},{default:t(()=>[i("获取AI评价")]),_:1})]),_:2},1024))),128))]),_:1}),r("div",ra,[o(k,{modelValue:b.value,"onUpdate:modelValue":a[6]||(a[6]=c=>b.value=c),autosize:{minRows:4,maxRows:10},type:"textarea",placeholder:"手动输入评价"},null,8,["modelValue"])]),r("div",ua,[o(l,{onClick:ce,size:"large",type:"success"},{default:t(()=>[i("批改完成")]),_:1}),o(l,{disabled:m.value==ae(E).length&&x.value==y.value.length-1,size:"large",type:"info",onClick:de},{default:t(()=>[i("下一份")]),_:1},8,["disabled"]),o(l,{disabled:T.value=="",onClick:ie,size:"large",type:"danger"},{default:t(()=>[i("删除打分结果")]),_:1},8,["disabled"])])])])])])}}},La=Ne(ca,[["__scopeId","data-v-672bea97"]]);export{La as default};

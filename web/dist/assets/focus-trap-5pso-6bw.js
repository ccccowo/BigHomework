import{an as e,aC as t,aE as n,bv as o,B as s,a6 as r,h as a,d as u,p as c,A as d,u as i,r as l,T as f,M as p}from"./index-afE12XCz.js";import{P as v,y as E,_ as m,e as T}from"./el-button-wvYaTM86.js";function L(e){return void 0===e}var y=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(y||{});const h=e=>{if(!t(e))return{};const s=e.props||{},r=(t(e.type)?e.type.props:void 0)||{},a={};return Object.keys(r).forEach((e=>{n(r[e],"default")&&(a[e]=r[e].default)})),Object.keys(s).forEach((e=>{a[o(e)]=s[e]})),a},S=n=>{const o=e(n)?n:[n],s=[];return o.forEach((n=>{var o;e(n)?s.push(...S(n)):t(n)&&e(n.children)?s.push(...S(n.children)):(s.push(n),t(n)&&(null==(o=n.component)?void 0:o.subTree)&&s.push(...S(n.component.subTree)))})),s};let w=[];const b=e=>{const t=e;t.key===E.esc&&w.forEach((e=>e(t)))},A="focus-trap.focus-after-trapped",N="focus-trap.focus-after-released",R={cancelable:!0,bubbles:!1},P={cancelable:!0,bubbles:!1},_="focusAfterTrapped",F="focusAfterReleased",D=Symbol("elFocusTrap"),I=a(),K=a(0),O=a(0);let k=0;const C=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},g=(e,t)=>{for(const n of e)if(!M(n,t))return n},M=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},Y=(e,t)=>{if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),O.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function H(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const B=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=H(e,t),e.unshift(t)},remove:t=>{var n,o;e=H(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),j=()=>{I.value="pointer",K.value=window.performance.now()},G=()=>{I.value="keyboard",K.value=window.performance.now()},U=e=>new CustomEvent("focus-trap.focusout-prevented",{...P,detail:e});var x=m(u({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[_,F,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const n=a();let o,u;const{focusReason:l}=(s((()=>{0===k&&(document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),document.addEventListener("keydown",G)),k++})),r((()=>{k--,k<=0&&(document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j),document.removeEventListener("keydown",G))})),{focusReason:I,lastUserFocusTimestamp:K,lastAutomatedFocusTimestamp:O});var m;m=n=>{e.trapped&&!L.paused&&t("release-requested",n)},s((()=>{0===w.length&&document.addEventListener("keydown",b),v&&w.push(m)})),r((()=>{w=w.filter((e=>e!==m)),0===w.length&&v&&document.removeEventListener("keydown",b)}));const L={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},y=n=>{if(!e.loop&&!e.trapped)return;if(L.paused)return;const{key:o,altKey:s,ctrlKey:r,metaKey:a,currentTarget:u,shiftKey:c}=n,{loop:d}=e,i=o===E.tab&&!s&&!r&&!a,f=document.activeElement;if(i&&f){const e=u,[o,s]=(e=>{const t=C(e);return[g(t,e),g(t.reverse(),e)]})(e);if(o&&s)if(c||f!==s){if(c&&[o,e].includes(f)){const e=U({focusReason:l.value});t("focusout-prevented",e),e.defaultPrevented||(n.preventDefault(),d&&Y(s,!0))}}else{const e=U({focusReason:l.value});t("focusout-prevented",e),e.defaultPrevented||(n.preventDefault(),d&&Y(o,!0))}else if(f===e){const e=U({focusReason:l.value});t("focusout-prevented",e),e.defaultPrevented||n.preventDefault()}}};c(D,{focusTrapRef:n,onKeydown:y}),d((()=>e.focusTrapEl),(e=>{e&&(n.value=e)}),{immediate:!0}),d([n],(([e],[t])=>{e&&(e.addEventListener("keydown",y),e.addEventListener("focusin",P),e.addEventListener("focusout",M)),t&&(t.removeEventListener("keydown",y),t.removeEventListener("focusin",P),t.removeEventListener("focusout",M))}));const h=e=>{t(_,e)},S=e=>t(F,e),P=s=>{const r=i(n);if(!r)return;const a=s.target,c=s.relatedTarget,d=a&&r.contains(a);if(!e.trapped){c&&r.contains(c)||(o=c)}d&&t("focusin",s),L.paused||e.trapped&&(d?u=a:Y(u,!0))},M=o=>{const s=i(n);if(!L.paused&&s)if(e.trapped){const n=o.relatedTarget;T(n)||s.contains(n)||setTimeout((()=>{if(!L.paused&&e.trapped){const e=U({focusReason:l.value});t("focusout-prevented",e),e.defaultPrevented||Y(u,!0)}}),0)}else{const e=o.target;e&&s.contains(e)||t("focusout",o)}};async function H(){await f();const t=i(n);if(t){B.push(L);const n=t.contains(document.activeElement)?o:document.activeElement;o=n;if(!t.contains(n)){const o=new Event(A,R);t.addEventListener(A,h),t.dispatchEvent(o),o.defaultPrevented||f((()=>{let o=e.focusStartEl;p(o)||(Y(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(Y(o,t),document.activeElement!==n)return})(C(t),!0),document.activeElement!==n&&"container"!==o||Y(t)}))}}}function x(){const e=i(n);if(e){e.removeEventListener(A,h);const t=new CustomEvent(N,{...R,detail:{focusReason:l.value}});e.addEventListener(N,S),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=l.value&&K.value>O.value&&!e.contains(document.activeElement)||Y(null!=o?o:document.body),e.removeEventListener(N,S),B.remove(L)}}return s((()=>{e.trapped&&H(),d((()=>e.trapped),(e=>{e?H():x()}))})),r((()=>{e.trapped&&x()})),{onKeydown:y}}}),[["render",function(e,t,n,o,s,r){return l(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);export{x as E,D as F,y as P,S as f,h as g,L as i};

import{E as Q}from"./base-fLZH5HYv.js";import{E as W}from"./el-overlay-3p0HJUYO.js";import{u as F,d as X,E as Y}from"./imghandle-ghtuly_l.js";/* empty css                */import{E as L,a as Z}from"./el-switch-gxFK0I1j.js";import{E as ee,a as ae}from"./el-tab-pane-ADmHeYbl.js";import{E as te}from"./el-scrollbar-IRktW7Zh.js";import{E as se}from"./el-button-ERDUNANg.js";import{E as oe}from"./el-empty-D82_fAVc.js";import{l as O,r as le,s as ne,d as ie}from"./test-_J6LAQoB.js";import{_ as ce,h as c,j as d,k as l,w as s,o as i,a as A,I as v,s as a,F as T,O as U,l as r,t as G,v as re,x as de,y as ue}from"./index-8Q_9VYoB.js";import{E as g}from"./index-KvpZgIRM.js";import"./index-MF98tEZs.js";import"./vnode-V_EyjqrJ.js";import"./focus-trap-pXtmz6jJ.js";import"./_baseClone-kDeojI09.js";import"./_Uint8Array-LNA8QHR0.js";import"./_initCloneObject-1JMVk_fm.js";import"./isEqual-L6DaMkDH.js";import"./request-_oO3txSX.js";import"./axios-_sX4vCAy.js";import"./validator-SivaTYXf.js";import"./strings-KykFHDex.js";import"./request2-j_m9nIWH.js";const u=w=>(de("data-v-b4165f53"),w=w(),ue(),w),pe={class:"bottom"},me=["onClick"],_e={href:"javascript:;"},fe=u(()=>a("svg",{class:"icon testIcon","aria-hidden":"true"},[a("use",{"xlink:href":"#icon-a-044_shige"})],-1)),ve={class:"content"},ge=u(()=>a("div",{class:"test"},null,-1)),he={class:"bottom"},Ie={href:"javascript:;"},ye=u(()=>a("svg",{class:"icon testIcon","aria-hidden":"true"},[a("use",{"xlink:href":"#icon-a-044_shige"})],-1)),we={class:"content"},ke={class:"switch"},xe=u(()=>a("div",{class:"el-upload__text"},[r(" Drop file here or "),a("em",null,"click to upload")],-1)),Ee=u(()=>a("div",{class:"el-upload__tip"}," jpg/png files ",-1)),be=u(()=>a("div",{class:"el-upload__text"},[r(" Drop file here or "),a("em",null,"click to upload")],-1)),Ae=u(()=>a("div",{class:"el-upload__tip"}," xlsx file ",-1)),Ce={key:2,class:"img"},Pe=u(()=>a("div",{class:"title"},"学生答卷:",-1)),Ve=["src"],Le={key:3,class:"excel"},Te=u(()=>a("div",{class:"title"},"准考证号:",-1)),Ue=["href"],Ne={class:"dialog-footer"},Se={__name:"AwPage",setup(w){const N=c("first"),k=c([]),S=async()=>{const o=await O();k.value=o.data.data.filter(e=>e.hasAnswers==0),console.log("-----------------------------"),console.log(k.value)};S();const m=c({paperId:1,imgs:[],cert:""}),x=c(""),J=o=>{console.log(o),m.value.paperId=o.paperIds.slice(1,-1),x.value=o.examId},h=c(!1),f=c([]),I=c([]),M=async()=>{if(f.value.length==0){g({message:"请上传答卷",type:"warning"});return}for(let e of f.value)if(e.raw.type!=="image/jpeg"&&e.raw.type!=="image/png")return g.error("Picture must be JPG/Peng format!"),!1;const o=L.service({fullscreen:!0});for(let e of f.value){const p=e.raw.name,n=await F(p,e.raw);console.log("上传答卷成功！"),console.log(n.data),m.value.imgs.push(n.data)}f.value=[],o.close(),g({message:"上传答卷成功！",type:"success"})},R=async()=>{if(I.value.length==0){g({message:"请上传准考证",type:"warning"});return}const o=L.service({fullscreen:!0});for(let e of I.value){const p=e.raw.name,n=await F(p,e.raw);console.log("上传准考证成功！"),console.log(n.data),m.value.cert=n.data}I.value=[],o.close(),g({message:"上传准考证成功",type:"success"})},H=async()=>{const o=L.service({fullscreen:!0});_.value==!0&&(m.value.imgs=B.value,m.value.cert=D.value),console.log("开始请求接口批量切割答卷and获取准考证号");const e=await X(m.value);console.log(e.data);const p=e.data.ans,n=e.data.cert;console.log("添加答卷");for(let y of p){const V={examId:x.value,paperId:m.value.paperId,certId:y.certId,quesId:y.quesId,ansImg:y.url,scanResult:"TAT"},b=await le(V);console.log(b.data)}console.log("添加准考证号");const P={examId:x.value,certs:n},E=await ne(P);console.log(E.data),g({message:"上传成功",type:"success"}),await ie(x.value,1),o.close(),h.value=!1,S(),j()},C=c([]),j=async()=>{const o=await O();C.value=o.data.data.filter(e=>e.hasAnswers==1)};j();const _=c(!1),B=c(["http://8.137.85.0:8008/files/download/img903bae08-ea84-11ee-9d5a-00163e04f5e4.png","http://8.137.85.0:8008/files/download/img9c566ebc-ea84-11ee-9d5a-00163e04f5e4.png"]),D=c("http://8.137.85.0:8008/files/download/imgaba8f682-ea84-11ee-9d5a-00163e04f5e4.xlsx");return(o,e)=>{const p=oe,n=se,P=te,E=ae,y=ee,V=Z,b=re("upload-filled"),$=Q,z=Y,K=W;return i(),d("div",null,[l(y,{type:"card",modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=t=>N.value=t),class:"demo-tabs",onTabClick:o.handleClick},{default:s(()=>[l(E,{label:"未开始",name:"first"},{default:s(()=>[k.value.length===0?(i(),A(p,{key:0,class:"bottom","image-size":200})):v("",!0),a("ul",pe,[l(P,null,{default:s(()=>[(i(!0),d(T,null,U(k.value,t=>(i(),d("li",{key:t.examId,onClick:q=>J(t)},[a("a",_e,[fe,a("div",ve,[r(G(t.examName)+" ",1),l(n,{onClick:e[0]||(e[0]=q=>h.value=!0),class:"start",type:"primary",plain:""},{default:s(()=>[r("上传答卷")]),_:1})])])],8,me))),128))]),_:1})]),ge]),_:1}),l(E,{label:"已完成",name:"three"},{default:s(()=>[C.value.length===0?(i(),A(p,{key:0,class:"bottom","image-size":200})):v("",!0),a("ul",he,[(i(!0),d(T,null,U(C.value,t=>(i(),d("li",{key:t.examId},[a("a",Ie,[ye,a("div",we,[r(G(t.examName)+" ",1),l(n,{onClick:q=>o.$router.push({path:"/assign",query:{examId:t.examId}}),class:"start",type:"primary",plain:""},{default:s(()=>[r("分配阅卷任务")]),_:2},1032,["onClick"])])])]))),128))])]),_:1})]),_:1},8,["modelValue","onTabClick"]),l(K,{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=t=>h.value=t)},{footer:s(()=>[a("span",Ne,[l(n,{onClick:e[5]||(e[5]=t=>h.value=!1)},{default:s(()=>[r("取消上传")]),_:1}),l(n,{onClick:H,type:"primary"},{default:s(()=>[r("确认上传")]),_:1})])]),default:s(()=>[a("div",ke,[l(V,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t)},null,8,["modelValue"]),r("是否开启演示模式")]),_.value?v("",!0):(i(),A(z,{key:0,"file-list":f.value,"onUpdate:fileList":e[3]||(e[3]=t=>f.value=t),class:"upload-demo",drag:"",action:"#",multiple:"","auto-upload":!1},{tip:s(()=>[Ee,l(n,{type:"success",plain:"",size:"large",onClick:M},{default:s(()=>[r("确认上传答卷")]),_:1})]),default:s(()=>[l($,{class:"el-icon--upload"},{default:s(()=>[l(b)]),_:1}),xe]),_:1},8,["file-list"])),_.value?v("",!0):(i(),A(z,{key:1,"file-list":I.value,"onUpdate:fileList":e[4]||(e[4]=t=>I.value=t),class:"upload-demo",drag:"",action:"#",multiple:"","auto-upload":!1},{tip:s(()=>[Ae,l(n,{type:"success",plain:"",size:"large",onClick:R},{default:s(()=>[r("确认上传准考证")]),_:1})]),default:s(()=>[l($,{class:"el-icon--upload"},{default:s(()=>[l(b)]),_:1}),be]),_:1},8,["file-list"])),_.value?(i(),d("div",Ce,[Pe,(i(!0),d(T,null,U(B.value,t=>(i(),d("img",{src:t},null,8,Ve))),256))])):v("",!0),_.value?(i(),d("div",Le,[Te,a("a",{href:D.value}," 本次考试准考证号",8,Ue)])):v("",!0)]),_:1},8,["modelValue"])])}}},la=ce(Se,[["__scopeId","data-v-b4165f53"]]);export{la as default};
